# Story 1.2: Portal HITL (Human-in-the-Loop)

## Status
**Done**

## Story
**As a** revisor de ofícios,  
**I want** um portal guiado em 4 passos para revisar ofícios processados pela IA,  
**so that** eu possa validar e corrigir dados extraídos antes da geração de resposta.

## Acceptance Criteria
1. Portal deve ter 4 passos claros e guiados
2. Passo 1: Visualizar PDF do ofício
3. Passo 2: Revisar dados extraídos pela IA
4. Passo 3: Corrigir dados e adicionar contexto
5. Passo 4: Aprovar ou rejeitar
6. Deve mostrar nível de confiança da IA
7. Aprovação deve disparar W4 (geração de resposta)
8. Interface deve ser intuitiva e elegante

## Tasks / Subtasks
- [x] Task 1: Criar página de revisão (AC: 1,2)
  - [x] Route `/revisao/[id]`
  - [x] Componente WizardSteps
  - [x] Navegação entre passos
- [x] Task 2: Implementar visualizador PDF (AC: 2)
  - [x] Integrar react-pdf
  - [x] Componente DocumentViewer
  - [x] Controles de zoom/navegação
- [x] Task 3: Formulário de revisão (AC: 3,4,5)
  - [x] ComplianceReviewForm
  - [x] Exibir dados IA
  - [x] Campos editáveis
  - [x] Campo contexto jurídico
- [x] Task 4: Indicadores de confiança (AC: 6)
  - [x] ConfidenceBadge component
  - [x] Cores baseadas em threshold
  - [x] ExtractionResults display
- [x] Task 5: Integração API (AC: 7)
  - [x] Conectar com webhook W3
  - [x] Aprovar → disparar W4
  - [x] Atualizar Supabase

## Dev Notes

### Arquitetura
- **Framework:** Next.js 15 App Router
- **UI:** React 19 + Tailwind CSS v4
- **PDF:** react-pdf 10.2.0
- **State:** React hooks

### UX Design
- 4 passos visuais claros
- Indicadores de progresso
- Feedback visual (badges de confiança)
- Toast notifications
- Design system ness.

### Source Tree
```
src/
├── app/revisao/[id]/page.tsx
├── components/hitl/
│   ├── WizardSteps.tsx
│   ├── DocumentViewer.tsx
│   ├── ConfidenceBadge.tsx
│   ├── ExtractionResults.tsx
│   └── ComplianceReviewForm.tsx
└── lib/
    ├── api-client.ts
    └── python-backend.ts
```

### Testing
- Testar todos os 4 passos
- Validar PDF rendering
- Testar aprovação/rejeição
- Verificar integração W3/W4
- Testar com diferentes níveis de confiança

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-18 | 1.0 | Story criada retroativamente | Quinn (QA) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Completion Notes List
- Portal completo com UX guiada
- 6 componentes React criados
- Integração com API Gateway OK
- PDF viewer profissional
- Toast notifications elegantes

### File List
- `src/app/revisao/[id]/page.tsx`
- `src/components/hitl/WizardSteps.tsx`
- `src/components/hitl/DocumentViewer.tsx`
- `src/components/hitl/ConfidenceBadge.tsx`
- `src/components/hitl/ExtractionResults.tsx`
- `src/components/hitl/ComplianceReviewForm.tsx`
- `HITL_UX_DESIGN.md`

## QA Results
*Aguardando revisão QA completa*

